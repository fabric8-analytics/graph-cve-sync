#!/bin/bash

set -e
set -x


cve_ids=


git_repo=${1}
since_commit=${2}
ecosystem=${3}

pushd "$git_repo" > /dev/null
    modified_files=$(git diff --name-only "$since_commit" HEAD)

    for file in ${modified_files}; do
        if [[ ${file} == database/${ecosystem}/* ]]; then
            if [[ ${file} == *.yaml ]]; then
                file=${file%.yaml}
                year="$(echo "$file" | cut -d'/' -f3)"
                cid="$(echo "$file" | cut -d'/' -f4)"
                cve_ids="${cve_ids}CVE-${year}-${cid}\n"
            fi
        fi
    done


[ ! -z "$cve_ids" ] && echo -e "$cve_ids" || :
